<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FORGE VTT PRO</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#58a6ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="pions/31040.png">
    <link rel="stylesheet" href="style.css?v=2">
</head>
<body>
    <nav class="side-bar">
        <button onclick="UI.showTab('pions')">ğŸ›¡ï¸</button>
        <button onclick="UI.showTab('maps')">ğŸ—ºï¸</button>
        <button onclick="UI.toggleGroupMenu()">ğŸ‘¥</button>
        <div id="group-select-menu" class="sub-menu">
            <button onclick="App.clearSelection()">G0</button>
            <button onclick="App.selectGroup(1)">G1</button>
            <button onclick="App.selectGroup(2)">G2</button>
            <button onclick="App.selectGroup(3)">G3</button>
        </div>
        <hr>
        <button id="btn-lock-map" onclick="App.toggleMapLock()">ğŸ”“</button>
        <button onclick="App.toggleGrid()">#</button>
        <button onclick="UI.openMapConfig()">âš™ï¸</button>
        <button onclick="App.toggleFog()">ğŸŒ«ï¸</button>
        <div id="fog-sub-tools" class="sub-menu">
            <button onclick="App.setFogBrush('erase')">ğŸ”“</button>
            <button onclick="App.setFogBrush('paint')">ğŸ”’</button>
            <button onclick="App.fillFog()">â¬›</button>
        </div>
        <button onclick="UI.toggleDiceMenu()">ğŸ²</button>
        <div id="dice-menu" class="sub-menu">
            <button onclick="UI.roll(4)">D4</button>
            <button onclick="UI.roll(6)">D6</button>
            <button onclick="UI.roll(20)">D20</button>
        </div>
        <div class="spacer"></div>
        <button onclick="IO.save()" style="background: var(--accent)">ğŸ’¾</button>
        <button onclick="IO.load()" style="background: #30363d">ğŸ“‚</button>
    </nav>

    <main id="game-container">
        <canvas id="map-canvas"></canvas>
        <div id="token-layer"></div>
        <canvas id="fog-canvas"></canvas>
    </main>

    <aside id="library-panel" style="display:none">
        <div style="display:flex; justify-content: flex-end; padding: 5px;">
            <button onclick="UI.hidePanel()" class="btn-close">âœ•</button>
        </div>
        <div id="section-pions" class="lib-section">
            <h3>PIONS</h3>
            <div id="pion-list" class="compact-grid"></div>
        </div>
        <div id="section-maps" class="lib-section" style="display:none">
            <h3>SCÃˆNES</h3>
            <div id="active-scenes-list" class="active-list"></div>
            <hr>
            <h3>MAPS</h3>
            <div id="map-list" class="compact-grid"></div>
        </div>
    </aside>

    <div id="pop-pion" class="modal">
        <div class="modal-content">
            <h3>Configuration</h3>
            <label>Nom</label><input type="text" id="in-name" oninput="updateSelected('name', this.value)">
            <label>PV / Max</label>
            <div style="display: flex; gap: 10px;">
                <input type="number" id="in-hp" oninput="updateSelected('hp', this.value)">
                <input type="number" id="in-hpmax" oninput="updateSelected('hpMax', this.value)">
            </div>
            <div class="modal-btns">
                <button onclick="rotateS()">ğŸ”„</button>
                <button onclick="flipS()">â†”ï¸</button>
                <button id="btn-lock" onclick="lockS()">ğŸ”“</button>
            </div>
            <label>Taille / Aura</label>
            <input type="range" min="20" max="300" id="in-size" oninput="updateSelected('s', this.value)">
            <input type="range" min="0" max="250" id="in-aura-s" oninput="updateSelected('auraS', this.value)">
            <input type="color" id="in-aura-c" oninput="updateSelected('auraC', this.value)">
            <div class="modal-footer">
                <button onclick="deleteS()" class="btn-del">Supprimer</button>
                <button onclick="UI.close()">Fermer</button>
            </div>
        </div>
    </div>

    <div id="pop-map" class="modal">
        <div class="modal-content">
            <h3>Grille</h3>
            <label>Taille : <span id="val-grid">50</span>px</label>
            <input type="range" min="20" max="150" value="50" id="in-grid-size" oninput="App.updateGridSettings()">
            <button onclick="UI.close()" style="width:100%; margin-top:15px;">OK</button>
        </div>
    </div>

    <script src="script.js?v=2"></script>
</body>
</html>